name: Build & Push Node.js 17 to OCI Image Registry

on:
  push:
    branches:
      - main
    paths:
      - "17/**/Dockerfile"
  pull_request:
    branches:
      - main
    paths:
      - "17/**/Dockerfile"

jobs:
  workdir:
    uses: ./.github/workflows/specify-workdir.yml
    with:
      base-dir: 17

  image:
    uses: ./.github/workflows/build.yml
    needs: workdir
    with:
      workdirs: ${{ needs.workdir.outputs.workdirs-array }}
      images: |
        docker.io/hazmi35/node
        ghcr.io/hazmi35/node
    secrets:
      docker-hub-username: hazmi35
      docker-hub-access-token: ${{ secrets.DOCKER_HUB_ACCESS_TOKEN }}
      ghcr-username: ${{ github.repository_owner }}
      ghcr-access-token: ${{ secrets.GITHUB_TOKEN }}
